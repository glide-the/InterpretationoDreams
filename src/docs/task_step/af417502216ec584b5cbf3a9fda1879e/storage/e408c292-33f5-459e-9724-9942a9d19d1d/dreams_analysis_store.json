{"analysis_store/data": {"f99c68db-aedb-4ef1-8026-99057ee65ad3": {"__data__": {"id_": "f99c68db-aedb-4ef1-8026-99057ee65ad3", "metadata": {}, "relationships": {}, "hash": "", "story_scenario_context": "### \u7b2c\u4e00\u6b65\uff1a\u63d0\u53d6\u5173\u952e\u4fe1\u606f\n1. **\u7814\u7a76\u65b9\u5411\u76f8\u5173**\uff1a\u793e\u4ea4\u5a92\u4f53\u4e2d\u7684\u7231\u60c5\u8868\u73b0\u3001\u5362\u66fc\u7231\u60c5\u8bed\u4e49\u5b66\u5728\u7535\u89c6\u7535\u5f71\u4e2d\u7684\u5e94\u7528\u3001\u6df1\u5165\u7814\u7a76\u5362\u66fc\u7406\u8bba\u53ca\u5176\u5728\u793e\u4f1a\u5b66\u7814\u7a76\u4e2d\u7684\u6f5c\u5728\u5e94\u7528\u3001\u63a2\u8ba8\u5362\u66fc\u7406\u8bba\u548c\u793e\u4f1a\u5b66\u7684\u4ea4\u53c9\u70b9\u3002\n2. **\u5173\u8054\u5173\u7cfb\u76f8\u5173**\uff1a\u5362\u66fc\u7231\u60c5\u8bed\u4e49\u5b66\u4e0e\u793e\u4ea4\u5a92\u4f53\u5185\u5bb9\u5bc6\u5207\u76f8\u8054\u3001\u4e0e\u793e\u4f1a\u5b66\u7814\u7a76\u9760\u8fd1\u5ea6\u3001\u63a5\u8fd1\u793e\u4ea4\u5a92\u4f53\u4e2d\u7684\u7231\u60c5\u8868\u73b0\u3001\u4e0e\u793e\u4f1a\u5b66\u89c2\u70b9\u76f8\u4ea4\u3001\u793e\u4ea4\u5a92\u4f53\u4e2d\u7684\u7231\u60c5\u8868\u73b0\u4e0e\u5362\u66fc\u7406\u8bba\u5b58\u5728\u91cd\u53e0\u3002\n3. **\u5176\u4ed6\u76f8\u5173**\uff1a\u7814\u7a76\u4e0e\u793e\u4f1a\u5b66\u7814\u7a76\u4e2d\u7684\u60c5\u611f\u56e0\u7d20\u5bc6\u5207\u76f8\u5173\u3001\u8ba8\u8bba\u4e0e\u5a92\u4f53\u4e2d\u7684\u8bed\u4e49\u4fe1\u606f\u6709\u5173\u3002\n\n### \u7b2c\u4e8c\u6b65\uff1a\u603b\u7ed3\u7a81\u51fa\u7279\u70b9\n1. **\u7814\u7a76\u5efa\u8bae\u591a\u5143**\uff1a\u6d89\u53ca\u793e\u4ea4\u5a92\u4f53\u7231\u60c5\u8868\u73b0\u3001\u5f71\u89c6\u5e94\u7528\u4ee5\u53ca\u7406\u8bba\u5728\u793e\u4f1a\u5b66\u7814\u7a76\u5e94\u7528\u7b49\u591a\u65b9\u9762\u7814\u7a76\u5efa\u8bae\u3002\n2. **\u5f3a\u8c03\u5173\u8054**\uff1a\u7a81\u51fa\u5362\u66fc\u7231\u60c5\u8bed\u4e49\u5b66\u4e0e\u793e\u4ea4\u5a92\u4f53\u5185\u5bb9\u3001\u793e\u4f1a\u5b66\u7814\u7a76\u4e4b\u95f4\u7684\u7d27\u5bc6\u5173\u8054\u3002\n3. **\u805a\u7126\u4ea4\u53c9**\uff1a\u91cd\u89c6\u5362\u66fc\u7406\u8bba\u4e0e\u793e\u4f1a\u5b66\u7684\u4ea4\u53c9\u70b9\u7814\u7a76\u3002\n4. **\u6d89\u53ca\u60c5\u611f\u4e0e\u8bed\u4e49**\uff1a\u7814\u7a76\u4e0e\u793e\u4f1a\u5b66\u60c5\u611f\u56e0\u7d20\u3001\u5a92\u4f53\u8bed\u4e49\u4fe1\u606f\u76f8\u5173\u3002 ", "scene_monologue_context": "\u4eca\u5929\u6211\u6df1\u5165\u7814\u7a76\u4e86\u5173\u4e8eTransformer\u76f8\u5173\u7684\u8bf8\u591a\u5185\u5bb9\uff0c\u611f\u89c9\u6536\u83b7\u6ee1\u6ee1\uff0c\u4f46\u4e5f\u6709\u4e9b\u70e7\u8111\u3002  \n\n\u5148\u662f\u805a\u7126\u5728\u7814\u7a76\u8bba\u6587\u4e2d\u5404\u7c7b\u6846\u67b6\u5728\u4e0d\u540c\u4efb\u52a1\u91cc\u7684\u5e94\u7528\u4e0e\u53d8\u4f53\uff0c\u5c24\u5176\u662fTransformer\u5728\u8ba1\u7b97\u673a\u89c6\u89c9\u6a21\u578b\u9886\u57df\u3002\u6211\u7740\u91cd\u63a2\u8ba8\u4e86LayerNorm\u548cRMSNorm\u4e3a\u9002\u914d\u89c6\u89c9\u4efb\u52a1\u9700\u6c42\u6240\u505a\u7684\u9002\u5e94\u6027\u8c03\u6574\u4e0e\u53d8\u4f53\u5e94\u7528\u3002\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4e86\u89e3\u5230\u5c06transformer\u7f51\u7edc\u91cc\u7684LayerNorm\u8f6c\u6362\u4e3aRMSNorm\u65f6\uff0c\u9700\u8981\u5bf9\u4e0d\u540c\u6a21\u5757\u8fdb\u884c\u4e00\u7cfb\u5217\u590d\u6742\u7684\u64cd\u4f5c\uff0c\u50cf\u8c03\u6574\u6b63\u4ea4\u77e9\u9635\u3001\u5bf9\u8f93\u5165\u8f93\u51fa\u77e9\u9635\u505a\u7279\u5b9a\u53d8\u6362\uff0c\u8fd8\u5f97\u5728\u6b8b\u5dee\u8fde\u63a5\u4e2d\u6dfb\u52a0\u65b0\u7684\u7ebf\u6027\u5c42 \uff0c\u8fd9\u4e9b\u64cd\u4f5c\u867d\u7136\u4f1a\u7ed9\u6a21\u578b\u5e26\u6765\u4e00\u5b9a\u989d\u5916\u5f00\u9500\uff0c\u4f46\u5bf9\u5b9e\u73b0\u6a21\u578b\u5207\u7247\u548c\u63d0\u5347\u6574\u4f53\u901f\u5ea6\u81f3\u5173\u91cd\u8981\u3002  \n\n\u4e4b\u540e\u53c8\u63a5\u89e6\u5230HE\u53cb\u597d\u578b\u5f52\u4e00\u5316\u76f8\u5173\u77e5\u8bc6\u3002\u4e3a\u4e86\u589e\u5f3a\u8bad\u7ec3\u7a33\u5b9a\u6027\uff0ctransformers\u901a\u5e38\u4f9d\u8d56LayerNorm \uff0c\u53ef\u5728HE\u4e0a\u8ba1\u7b97LayerNorm\u6d89\u53ca\u7684\u5f00\u65b9\u5012\u6570\u5e76\u975e\u591a\u9879\u5f0f\u8fd0\u7b97\u3002\u5c1d\u8bd5\u7528BatchNorm\u66ff\u4ee3LayerNorm\u8bad\u7ec3transformers\u65f6\uff0c\u53d1\u73b0\u6a21\u578b\u5728\u89c6\u89c9\u4efb\u52a1\u4e2d\u8868\u73b0\u4e0d\u4f73\uff0c\u5728NLP\u4efb\u52a1\u91cc\u751a\u81f3\u65e0\u6cd5\u6536\u655b\u3002\u6240\u4ee5\u9488\u5bf9\u89c6\u89c9\u548cNLP\u4efb\u52a1\u5f97\u91c7\u53d6\u4e0d\u540c\u65b9\u6cd5\u3002\u5728\u89c6\u89c9transformers\u7684MLP\u548c$\\\\sigma$ -attention\u91cc\u6dfb\u52a0\u989d\u5916BatchNorm \uff0c\u80fd\u6539\u5584\u6027\u80fd\u548c\u8bad\u7ec3\u7a33\u5b9a\u6027\uff1b\u800c\u5bf9\u4e8eNLP\u4efb\u52a1\uff0c\u5f97\u901a\u8fc7\u8fd1\u4f3c\u591a\u9879\u5f0f\u6765\u903c\u8fd1LayerNorm \uff0c\u5148\u7f29\u5c0f\u65b9\u5dee\u8303\u56f4\uff0c\u518d\u5229\u7528\u5df2\u77e5\u8fd1\u4f3c\u65b9\u6cd5\u5904\u7406\u5f00\u65b9\u5012\u6570\u3002  \n\n\u8fd8\u5b66\u4e60\u4e86\u6784\u5efa\u591a\u9879\u5f0fTransformer\u7684\u65b9\u6cd5\uff0c\u603b\u5171\u5206\u4e09\u4e2a\u9636\u6bb5\u3002\u9996\u5148\u628a\u539f\u59cb\u67b6\u6784\u4fee\u6539\u6210HE\u53cb\u597d\u578b\u67b6\u6784\uff0c\u63a5\u7740\u8fdb\u884c\u8865\u5145\u8bad\u7ec3\u83b7\u5f97HE\u53cb\u597d\u578b\u6743\u91cd\uff0c\u901a\u8fc7\u6dfb\u52a0\u635f\u5931\u51fd\u6570\u6765\u9650\u5236\u975e\u591a\u9879\u5f0f\u5c42\u7684\u8f93\u5165\u8303\u56f4\uff0c\u6700\u540e\u7528\u591a\u9879\u5f0f\u8fd1\u4f3c\u66ff\u6362\u975e\u591a\u9879\u5f0f\u5c42\uff0c\u5f97\u5230\u591a\u9879\u5f0f\u6a21\u578b\u3002  \n\n\u53e6\u5916\uff0c\u5728\u5b9e\u9a8c\u90e8\u5206\uff0c\u4e86\u89e3\u5230\u5bf9PreNorm\u548cPostNorm\u5728\u96f6\u6837\u672c\u7ffb\u8bd1\uff08ZST\uff09\u4efb\u52a1\u4e2d\u7684\u8bc4\u4f30\u3002\u5728\u4e0d\u540c\u6570\u636e\u96c6\u548c\u8bed\u8a00\u5bf9\u4e0a\u8fdb\u884c\u5b9e\u9a8c\uff0c\u5206\u6790\u5b83\u4eec\u7684\u8131\u9776\u7387\u548c\u7ed3\u6784\u5dee\u5f02\u3002\u5b9e\u9a8c\u7ed3\u679c\u663e\u793a\uff0c\u5728ZST\u4efb\u52a1\u4e2d\uff0cPostNorm\u5728\u4e0d\u540c\u8bed\u8a00\u6807\u7b7e\u548c\u6b8b\u5dee\u8fde\u63a5\u8bbe\u7f6e\u4e0b\uff0cBLEU\u5206\u6570\u901a\u5e38\u6bd4PreNorm\u66f4\u9ad8\uff0c\u4e0d\u8fc7\u5728\u76d1\u7763\u5b66\u4e60\u65b9\u5411\u4e0a\u4e8c\u8005\u6027\u80fd\u76f8\u8fd1\u3002\u8bed\u8a00\u6807\u7b7e\u548c\u6b8b\u5dee\u8fde\u63a5\u7684\u8bbe\u7f6e\u5bf9ZST\u6027\u80fd\u6709\u5f71\u54cd\uff0c \u201cT-ENC\u201d\u8bed\u8a00\u6807\u7b7e\u548c\u201cw/ Res.\u201d\u8bbe\u7f6e\u5bf9IWSLT\u7684ZST\u6027\u80fd\u6709\u63d0\u5347\uff0c\u4f46\u5bf9\u4e8eOPUS\u548cEuroparl \uff0cPostNorm\u642d\u914d \u201cS-ENC-T-DEC\u201d\u548c\u201cT-ENC\u201d\u6807\u7b7e\u4e14\u4f7f\u7528\u201cw/ Res.\u201d\u65f6\u6027\u80fd\u6700\u4f73\u3002\u8131\u9776\u7387\u65b9\u9762\uff0c\u4e0d\u540c\u8bed\u8a00\u6807\u7b7e\u8bbe\u7f6e\u4e0b\uff0cPreNorm\u548cPostNorm\u7684\u8131\u9776\u7387\u5dee\u5f02\u5bfc\u81f4\u4e86BLEU\u5206\u6570\u5dee\u8ddd\u4e0d\u540c\u3002  \n\n\u603b\u4e4b\uff0c\u4eca\u5929\u5728Transformer\u76f8\u5173\u77e5\u8bc6\u7684\u6d77\u6d0b\u91cc\u7545\u6e38\uff0c\u867d\u7136\u6709\u4e9b\u5403\u529b\uff0c\u4f46\u6bcf\u4e00\u70b9\u6536\u83b7\u90fd\u8ba9\u6211\u5bf9\u8fd9\u4e2a\u9886\u57df\u6709\u4e86\u66f4\u6df1\u7684\u8ba4\u8bc6\uff0c\u5e0c\u671b\u4e4b\u540e\u80fd\u5c06\u8fd9\u4e9b\u77e5\u8bc6\u8fd0\u7528\u5230\u5b9e\u9645\u4e2d\u3002  ", "user_id": "\u6b64\u6765\u8bbf\u8005", "scene_content": "\u89d2\u8272    \u5185\u5bb9    \u5206\u955c\n", "story_board_summary_context": "e408c292-33f5-459e-9724-9942a9d19d1d:\u300c\u7814\u7a76\u8bba\u6587\u4e2d\u91c7\u7528\u7684\u4e3b\u8981\u6846\u67b6\uff08\u5982Transformer\u3001GAN\u3001BERT\u7b49\uff09\u5728\u4e0d\u540c\u4efb\u52a1\u4e2d\u7684\u5e94\u7528\u4e0e\u53d8\u4f53\u300d\ne408c292-33f5-459e-9724-9942a9d19d1d:\u300c\u5728\u57fa\u4e8eTransformer\u7684\u8ba1\u7b97\u673a\u89c6\u89c9\u6a21\u578b\u4e2d\uff0cLayerNorm\u548cRMSNorm\u5177\u4f53\u8fdb\u884c\u4e86\u54ea\u4e9b\u9002\u5e94\u6027\u8c03\u6574\u548c\u53d8\u4f53\u5e94\u7528\u6765\u9002\u914d\u89c6\u89c9\u4efb\u52a1\u9700\u6c42\uff1f \u300d\ne408c292-33f5-459e-9724-9942a9d19d1d:\u300cref_ids: 454895409734360760, chunk_ids: 3, Score: 0.3711, Text: # 3.3 A TRANSFORMATION PER BLOCK\nNow that every LayerNorm in the transformer has been converted to RMSNorm, we can select any $\\\\mathbf{Q}$ to modify the model. Our initial plan was to collect signals from the model, construct an orthogonal matrix using those signals and to delete parts of the network. We quickly saw that the signals at different blocks of the network were not aligned, and that we would need to apply a different orthogonal matrix at each block, $\\\\mathbf{Q}_{\\\\ell}$ .  \n\nAllowing the orthogonal matrix used in each block to differ can be shown to leave the model unchanged using the same proof as Theorem 1 ,  \n\n  \nFigure 3: Converting a transformer network from LayerNorm to RMSNorm: the scale matrix diag $(\\\\alpha)$ is absorbed into the subsequent matrix $\\\\mathbf{W}_{\\\\mathrm{in}}$ . Figure shows the block in combined colors. We use $(\\\\alpha)$ for brevity. The mean-subtraction matrix $\\\\mathbf{M}$ is applied to each matrix $\\\\mathbf{W}_{\\\\mathrm{out}}$ . Layernorm becomes RMSNorm, up to a constant $\\\\bar{\\\\sqrt{D}}$ (not shown). Here, the scaling $(\\\\alpha^{\\\\prime})$ comes from the previous block.  \n\n  \nFigure 4: With the network converted to RMSNorm (see Figure 3 ), we apply the computational-invariance idea. The input weight matrices $\\\\mathrm{diag}(\\\\alpha)\\\\mathbf{W}_{\\\\mathrm{in}}$ are pre-multiplied by $\\\\mathbf{Q}^{\\\\top}$ . The output matrices $\\\\mathbf{W}_{\\\\mathrm{out}}\\\\mathbf{M}$ are post-multiplied by $\\\\mathbf{Q}$ . In the skip-connection, a new linear layer is added $\\\\mathbf{Q}_{\\\\ell}^{\\\\top}\\\\mathbf{Q}_{\\\\ell+1}$ . After these modifications, the matrices can be sliced (hatched areas).  \n\nwith the exception of line 5 of Algorithm 1 . Here we see that the residual connection and the output of the block must have the same rotation. To fix this, we modify the residual connection by applying the linear transformation applied to different blocks with the additional linear operation in the residual connection. Unlike the $\\\\mathbf{Q}_{\\\\ell-1}^{\\\\top}\\\\mathbf{Q}_{\\\\ell}$ \u2212to the residual. Figure 4 shows how different rotations can be modifications to the weight matrices, these additional operations cannot be pre-computed and add a small $(D\\\\times D)$ overhead to the model. Nonetheless, they are needed to allow slicing the model (Section 3.4 ) and we see real speedup overall (Section 4 ).  \n\nTo compute the matrices $\\\\mathbf{Q}_{\\\\ell}$ , we use PCA. We select a calibration dataset from the training set, run it through the model (after converting LayerNorm operations into RMSNorm), and extract the orthogonal matrix of the layer. We use the output of the transformed network to calculate the orthogonal matrices of the next layers. More precisely, if $\\\\mathbf{X}_{\\\\ell,i}$ is the output of the $\\\\ell^{\\\\mathrm{th}}$ RMSNorm block for the $i^{\\\\mathrm{th}}$ sequence in the calibration dataset, we compute  \n\n$$\n\\\\mathbf{C}_{\\\\ell}=\\\\sum_{i}\\\\mathbf{X}_{\\\\ell,i}^{\\\\top}\\\\mathbf{X}_{\\\\ell,i}\n$$  \n\nand set $\\\\mathbf{Q}_{\\\\ell}$ to the be the eigenvectors of $\\\\mathbf{C}_{\\\\ell}$ , sorted by decreasing eigenvalues.\n\n# 3.4 SLICING\nThe goal of Principal Component Analysis is usually to take a data matrix $\\\\mathbf{X}$ and compute a lower dimensional representation $\\\\mathbf{Z}$ , and an approximate reconstruction $\\\\tilde{\\\\mathbf{X}}$ :  \n\n$$\n\\\\mathbf{Z}=\\\\mathbf{X}\\\\mathbf{Q}\\\\mathbf{D}\\\\,,\\\\qquad\\\\tilde{\\\\mathbf{X}}=\\\\mathbf{Z}\\\\mathbf{D}^{\\\\top}\\\\mathbf{Q}^{\\\\top}\\\\,.\n$$  \n\nwhere $\\\\mathbf{Q}$ is the ectors of ${\\\\bf X}^{\\\\top}{\\\\bf X}$ , and $\\\\mathbf{D}$ is a $D\\\\times D_{\\\\mathrm{small}}$ deletion matrix (containing $D_{\\\\mathrm{small}}$ The reconstruction is columns of the $D\\\\times D$ \u00d7$L_{2}$ identity matrix), which removes some of the columns of the matrix to the left. optimal, in the sense that QD is a linear mapping that minimizes $\\\\lVert\\\\mathbf{X}-\\\\tilde{\\\\mathbf{X}}\\\\rVert^{2}$ .  \n\nWhen we apply PCA to the signal matrix $\\\\mathbf{X}$ bween blocks, we never materialize the $N\\\\times D$ signal matrix, but we apply the deletion matrix Dto the operations preceding and succeeding the construction of that matrix, which have already been multiplied by $\\\\mathbf{Q}$ in the above. We delete rows of $\\\\mathbf{W}_{\\\\mathrm{in}}$ that we have inserted into the residual connection (see Figure and columns of $\\\\mathbf{W}_{\\\\mathrm{out}}$ and $\\\\mathbf{W}_{\\\\mathrm{embd}}$ . We also delete both rows 4 ). and columns of the matrix $\\\\mathbf{Q}_{\\\\ell-1}^{\\\\top}\\\\mathbf{Q}_{\\\\ell}$ \u2212\n\n# 4 EXPERIMENTAL VALIDATION\nSetup We use HuggingFace Transformers ( Wolf et al. ,2019 ) to implement our code with PyTorch (Paszke et al. ,2019 ). The computation of $\\\\mathbf{Q}$ is performed on a single H100 GPU with 80GB of memory, taking approximately 3.5 hours to complete for the L LAMA -2 70B model. During the PCA calculation, we use double precision for computing the eigenvectors of the covariance matrix. We find that using single precision for eigenvector calculations in PyTorch leads to a discrepancy in the final accuracy, as detailed in Appendix A.2 .  \n\nWe experiment with two different calibration sets: 1024 samples from the WikiText-2 training dataset ( Merity et al. ,2016 ) and 5000 samples from the Alpaca training dataset ( Taori et al. ,2023 ). Sequence lengths are chosen as the maximum of each language model. An ablation study on the calibration set size and sequence length is presented in Appendix A.3 .  \n\nModels, Tasks, and GPUs We evaluate all our experiments on OPT ( Zhang et al. ,2022 ), L LAMA -2 (Touvron et al. ,2023 ) model families, and additionally evaluate Phi-2 (in our zero-shot task) experiments. We exclude OPT 175B, as it is outperformed by smaller L LAMA -2 models. Nonetheless, we anticipate that this larger model will yield improved results, as larger models typically offer more promising opportunities for compression (see Section 4.1 ). We evaluate our scheme on both language generation as well as popular zero-shot tasks. To demonstrate the comprehensive speedup achieved by SliceGPT we use: Quadro RTX6000 GPUs with 24GB of memory as a representative example of consumer-level GPUs; 40GB A100s and 80GB H100s to provide datacenter-level benchmarks.  \n\nBaseline Setup We initially planned to compare our results against a scheme that pruned columns (or rows) with the smallest norm but found that this baseline was very poor, with the perplexity of the model soaring into the 1000s after pruning just a few columns. Instead, we compare SliceGPT against SparseGPT ( Frantar & Alistarh ,2023 ) employing a 2:4 sparsity ratio, as this is the only sparsity scheme which achieves speedup ( Mishra et al. ,2021 ).\u300d\ne408c292-33f5-459e-9724-9942a9d19d1d:\u300cref_ids: 454847819065993190, chunk_ids: 1, Score: 0.3203, Text: # 4.2 HE-Friendly Normalization\nTo enhance training stability, transformers rely on LayerNorm , which is formulated as follows:  \n\n$$\n\\\\operatorname{LayerNorm}(x)={\\\\frac{x-\\\\mu}{\\\\sqrt{\\\\sigma^{2}}}}\\\\cdot\\\\gamma+\\\\beta\n$$  \n\nwhere $x$ is the input vector, $\\\\mu$ is the mean of $x,\\\\sigma^{2}$ is the variance, and $\\\\gamma$ and $\\\\beta$ are learnable parameters. Computing LayerNorm over HE requires calculating the inverse square root, which is not a polynomial operation. A common practice in designing neural networks for secure inference over HE is to replace LayerNorm with BatchNorm , as it can be implemented by a straightforward constant affine transformation at inference time. Therefore, we attempted to train transformers using $\\\\sigma$ -attention and BatchNorm . We observed that these models were highly unstable, performing poorly on vision tasks and failing to converge in NLP tasks. Consequently, we adopt two distinct approaches for vision and NLP tasks.  \n\nNormalization for Vision Transformers For vision transformers, to improve performance and mitigate training instability, we add two components: (i) Additional BatchNorm in the MLP of ViT, which is proposed in ( Yao et al. ,2021 ) as a stabilizer for ViT training, and (ii) additional BatchNorm within the $\\\\sigma$ -attention, which normalizes values across different attention heads, since we observe that those are the sources of instability. The resulting $\\\\sigma$ -attention variant is:  \n\n$$\n{\\\\frac{1}{\\\\mathrm{S}(L)}}\\\\sigma\\\\left({\\\\mathrm{BatchNorm~}}2\\\\mathrm{D}\\\\left({\\\\frac{Q K^{T}}{\\\\sqrt{d_{k}}}}\\\\right)\\\\right)V\n$$  \n\nNormalization for NLP Transformers For NLP, models with $\\\\sigma$ -attention and BatchNorm completely failed, even when augmented by stabilizing factors from the literature, such as ( Wang et al. ,2022 ). Consequently, we had to confront the challenge of approximating LayerNorm by polynomials, which entails approximating the inverse square root function. Empirically, we found that the values of the variance in trained transformers (with $\\\\sigma$ -attention) ranged between 1 and $10^{9}$ , causing approximation challenges due to the extremely large domain. To solve this problem, we first focus on narrowing the domain of the variance, which then makes it easier to approximate the inverse square root over this restricted domain. The method is similar to ( Baruch et al. ,2023 ), which introduces an additional loss function that encourages the model to minimize the range of the input to activation layers. We apply this technique on the variance at each layer via the following objective:  \n\n$$\n\\\\mathbb{L}_{\\\\mathrm{Variance\\\\;Minimization}}:=\\\\Sigma_{m=1}^{L_{N}}\\\\operatorname*{max}_{c\\\\in C,x_{i}\\\\in X}\\\\left(\\\\mathrm{var}_{m,c}^{i}\\\\right)\n$$  \n\nwhere we denote the number of layers by $N_{L}$ , the number of channels by $C$ , and the train dataset by $X:=[x_{1},x_{2},..]$ . Furthermore, we denote the variance at layer $m$ and channel $c$ , when the model processes the $x_{i}$ example by $\\\\mathrm{var}_{m,c}^{i}$ . For reasons of efficiency, we compute the loss over each batch rather than the whole training set $X$ . By extending this method to operate on layer normalization instead of activations, we succeed in reducing the variance range to a smaller domain. This reduction makes it feasible to use well-known approximations, such as the technique described in ( Baruch et al. ,2023 ), for the inverse square root.\n\n# 4.3 A Recipe for a Polynomial Transformer\nFig. 2 illustrates the entire method, which comprises three stages: (i) First we modify the architecture from the original transformer architecture (first column) to a HE-friendly architecture (second column), namely, an architecture that can eventually be converted into a polynomial form. Then we train the modified model from scratch with the same hyperparameters. (ii) In the second stage, we perform a supplementary training procedure to obtain a model with HE-friendly weights ,which means that each non-polynomial component will only operate on specific and restricted domains. To do so, we add a loss function that minimizes the range of inputs to non-polynomial layers. For the activations (standard activations and attention-activations), we directly apply the method from ( Baruch et al. ,2023 ), which defines the range loss for activations. For the LayerNorm layers, we use the loss defined in Eq. 11 . The whole training objective $\\\\mathbb{L}$ is defined by:\n\n# \u03b1LRange Minimization +\u03b2LVariance Minimization +Loriginal\nwhere $\\\\alpha$ and $\\\\beta$ are hyperparameters. (iii) Finally, each non-polynomial layer is directly replaced with its polynomial approximation, resulting in a polynomial model . Appendix A contains details on the approximation we used. Those approximations are accurate for the HE-friendly architecture & weights obtained from earlier stages.\n\n# 5 Experiments\nWe evaluate the polynomial models generated by our method in Section 5.1 , focusing on language modeling with the Wikitext-103 dataset and image classification using standard benchmarks, including Tiny-ImageNet and CIFAR-10. Section 5.2 justifies our methodological choices, specifically the use of scaled $\\\\sigma$ -attention and an additional training phase designed to manipulate the input values of non-polynomial layers. Furthermore, that section contains several ablation studies to assess the impact of each method component on the overall performance degradation. Section 5.3 discusses the accuracy and latency implications of applying our models over FHE. The experimental setup is detailed in Appendix B.\n\n# 5.1 Polynomial Models\nPolynomial Language Modeling We evaluated our BERT-like transformer model for language modeling as our NLP task. Specifically, we trained on Wikitext-103 with a self-supervised scheme for Next Token Prediction (NTP). The results in Table 1 show that after architectural and training modifications, we achieved a fully polynomial model with competitive perplexity scores. In particular, the perplexity increased by 0.91 compared to a vanilla transformer of the same size, from 18.98 to 19.89 for a 6-layer transformer (53.3M parameters), and by 2.02 from 16.89 to 18.91 for a 12- layer model (95.8 Mparameters). Considering that at least $80\\\\%$ of the gap between the vanilla transformer and our corresponding polynomial model is caused in the last stage where polynomial approximations are used (0.74 for 6 layers model and 1.76 for 12 layers), we hypothesize that more accurate polynomials can mitigate most of the performance gap.  \n\n<html><body><table><tr><td>Depth</td><td>Original</td><td>P</td><td>P+MR</td><td>Poly</td></tr><tr><td>6</td><td>18.98</td><td>19.07</td><td>19.15</td><td>19.89</td></tr><tr><td>12</td><td>16.89</td><td>16.98</td><td>17.15</td><td>18.91</td></tr></table></body></html>  \n\nTable 1: NLP Results: Perplexity results of a polynomial BERT-like transformer on the Wikitext-103 benchmark. \u2018Depth\u2019 indicates the number of transformer layers. \u2018Original\u2019 denotes the perplexity of the vanilla Softmax-based transformer of equivalent size. \u2018P\u2019 represents models utilizing scaled $\\\\sigma$ -attention, while $\\\\mathbf{\\\\dot{P}+M R}$ \u2019shows perplexity at the end of the range minimization training. \u2018Poly\u2019 details the final performance after substituting LayerNorm and activation functions with polynomial approximations.  \n\nPolynomial Image Classification We evaluated our vision models on two image classification benchmarks: Tiny-ImageNet and CIFAR-100. The results, presented in Table 2 , indicate that our vision models, which are converted to polynomial form by our methods, remain competitive. Specifically, for ViT on CIFAR-100, the original ViT (denoted as $\\\\mathbf{\\\\omega}^{\\\\bullet}\\\\mathbf{O}^{\\\\bullet}$ ) achieved a score of $73.4\\\\%$ , whereas our HE-friendly alternative $(\\\\mathrm{P+BN+QK+A})$ ), achieved a score of $71.1\\\\%$ . The HE-friendly alternative employs BatchNorm as the normalization layer, includes additional stabilizers described in 4.2 and is based on scaled$\\\\sigma$ attention. After applying our range-aware training procedure, the accuracy of our model decreased marginally by $0.1\\\\%$ to $71.0\\\\%$ , and it further decreased to $70.8\\\\%$ after approximating nonpolynomial components. For the Swin Transformer on Tiny-ImageNet, the original model achieved $59.4\\\\%$ , and transitioning to the HE-friendly architecture resulted in a performance decrease of $0.3\\\\%$ to $59.1\\\\%$ . After employing range-aware training to obtain HE-friendly weights, the performance further degraded by $0.2\\\\%$ to $58.9\\\\%$ , while the final performance of the polynomial model remained the same. In conclusion, the performance gap between the polynomial models and the original architectures is less than $4\\\\%$ , demonstrating the practicality of our methods in this domain.  \n\n<html><body><table><tr><td colspan=\"3\">Model Dataset 0 P+BN+QK+A MR Poly</td></tr><tr><td>ViT CIFAR-100</td><td>73.4 71.1</td><td>71.0 70.8</td></tr><tr><td>Swin</td><td>Tiny-ImgNet 59.4</td><td>59.1 58.9 58.9</td></tr></table></body></html>  \n\nTable 2: Vision Results: Test accuracy results of a polynomial ViT. \u2018O\u2019 represents the original vanilla model, $\\\\mathrm{{^{\\\\circ}\\\\mathrm{{P}+\\\\mathrm{{BN}+\\\\mathrm{{QK}+\\\\mathrm{{A}^{\\\\circ}}}}}}}$ represents scaled$\\\\boldsymbol{\\\\sigma}$ attention-based ViT trained with BatchNorm as the normalization function instead of LayerNorm , and contains the additional stabilizers described in 4.2 . \u2018MR\u2019 refers to the accuracy at the end of the range minimization training, and \u2018Poly\u2019 details the final performance after substituting polynomial approximations.\u300d\ne408c292-33f5-459e-9724-9942a9d19d1d:\u300cref_ids: 454895289196085862, chunk_ids: 3, Score: 0.2715, Text: # 3 Experiments and Results\nWe evaluate the performance of PreNorm and PostNorm for ZST on various datasets and language pairs. We then analyze the off-target rates and structural discrepancies between PreNorm and PostNorm to understand performance differences.  \n\n$$\n\\\\mathrm{LayerNorm}(\\\\mathbf{x})=\\\\frac{\\\\mathbf{x}-\\\\mathbf{E}(\\\\mathbf{x})}{\\\\sqrt{\\\\mathbf{V}(\\\\mathbf{x})}}\\\\cdot\\\\mathbf{g}+\\\\mathbf{b},\n$$  \n\nwhere $\\\\mathbf{g}$ and $\\\\mathbf{b}$ are trainable gain and bias. $\\\\mathbf{E}$ and $\\\\mathbf{V}$ indicate expectation and variance. LayerNorm is commonly used in two positions in the Transformer, as shown in Fig. 1 . PostNorm, which is the originally proposed setting of the Transformer ( Vaswani et al. ,2017 ), involves applying LayerNorm after each sub-module (i.e., selfattention or feed-forward network) and residual connections. PreNorm ( Baevski and Auli ,2019 ), on the other hand, involves applying LayerNorm directly before each sub-module and is known to stabilize Transformer training. While variants of Transformer LayerNorm like RMSNorm ( Zhang and Sennrich ,2019 ) have been proposed, the vanilla PreNorm and PostNorm are still the most widely adopted settings in current multilingual\n\n# 3.1 Experimental Settings\nDatasets We perform ZST experiments on three datasets: OPUS ( Zhang et al. ,2020 ), IWSLT ( Cettolo et al. ,2017 ), and Europarl ( Koehn ,2005 ). The statistics of the datasets are summarized in Table 1 .We include 7 ,4 , and 5 languages for each dataset. The training data consists of only English-centric sentence pairs, resulting in 30 ,6 , and 12 ZST directions for each dataset. The total number of parallel sentences for each dataset is 12 .00 M, 1 .38 M, and 15 .78 M, respectively. We apply BPE ( Sennrich et al. ,2016 ) with merge operations of 50 k, 40 k, and $50\\\\mathbf{k}$ to create a joint vocabulary for each dataset.  \n\nTraining We employ Transformer-base model for OPUS and IWSLT, and Transformer-big for Europarl, in accordance with the distinct sizes of training data. We consider the following settings: (1) PreNorm or PostNorm : PreNorm involves LayerNorm directly before each sub-module (i.e., self-attention or feed-forward network), while PostNorm applies LayerNorm after each sub-module and residual connections, as shown in Fig. 1 .(2) S-ENC-T-DEC or T-ENC : Source language tag on the encoder-side and target language tag on the decoder-side; or only target language tag on the encoder-side. Wu et al. (2021 ) showed that this setting impacts ZST for Transformer with PreNorm. (3) w/ or w/o Res. : With the residual connection for self-attention in the middle $(4^{t h})$ encoder layer or not. Liu et al. (2021 ) revealed that \u201cw/o Res.\u201d improves ZST for the model trained with PreNorm. We experiment this with different LayerNorm settings as this may reduce the potential of overfitting on supervised directions, then further impacts ZST, which aligns with our hypothesis.  \n\nTable 2: BLEU scores and off-target rates (shown in brackets) . We report the average score of three seeds; refer to Appendix Gfor BLEU score of each translation direction and seed. \u201cRes.\u201d indicates the residual connection of self-attention in the $4^{t h}$ encoder layer. We mark lower off-target rates and significantly higher BLEU scores ( Koehn ,2004 ) between PreNorm and PostNorm in bold for ZST.   \n\n\n<html><body><table><tr><td>#</td><td>Layer Norm</td><td>Language Tag</td><td>Res.</td><td></td><td>Zero-shot</td><td></td><td></td><td>Supervised</td><td></td></tr><tr><td>0</td><td></td><td>Pivot</td><td></td><td>OPUS 21.8</td><td>IWSLT 20.0</td><td>Europarl 29.5</td><td>OPUS</td><td>IWSLT</td><td>Europarl</td></tr><tr><td>1</td><td>PreNorm</td><td>S-ENC-T-DEC</td><td>w/</td><td>10.1 (42.19%)</td><td>4.9 (64.84%)</td><td>24.9 ( 7.73%)</td><td>33.7</td><td>31.5</td><td>34.3</td></tr><tr><td>2</td><td>PostNorm</td><td>S-ENC-T-DEC</td><td>w/</td><td>16.8 ( 8.59%)</td><td>12.4 (10.61%)</td><td>29.2( 0.34%)</td><td>33.9</td><td>31.5</td><td>34.5</td></tr><tr><td>3</td><td>PreNorm</td><td>T-ENC</td><td>w/</td><td>13.3 (22.99%)</td><td>13.7 ( 3.98%)</td><td>29.5( 0.23%)</td><td>33.7</td><td>31.6</td><td>34.4</td></tr><tr><td>4</td><td>PostNorm</td><td>T-ENC</td><td>w/</td><td>14.0 (22.86%)</td><td>15.5 ( 4.59%)</td><td>30.8 ( 0.11%)</td><td>34.1</td><td>31.5</td><td>34.5</td></tr><tr><td>5</td><td>PreNorm</td><td>S-ENC-T-DEC</td><td>w/o</td><td>14.3 (20.67%)</td><td>8.0 (50.16%)</td><td>16.7 (41.87%)</td><td>33.6</td><td>30.9</td><td>34.3</td></tr><tr><td>6</td><td>PostNorm</td><td>S-ENC-T-DEC</td><td>w/o</td><td>16.0 (15.27%)</td><td>17.4 (1.83%)</td><td>29.0 ( 0.41%)</td><td>33.8</td><td>30.7</td><td>34.4</td></tr><tr><td>7</td><td>PreNorm</td><td>T-ENC</td><td>w/o</td><td>13.4 (27.15%)</td><td>16.2 ( 1.54%)</td><td>29.9 ( 2.15%)</td><td>33.5</td><td>30.9</td><td>34.3</td></tr><tr><td>8</td><td>PostNorm</td><td>T-ENC</td><td>w/o</td><td>13.9 (26.68%)</td><td>17.8 (1.50%)</td><td>30.8 ( 0.13%)</td><td>33.9</td><td>30.6</td><td>34.4</td></tr></table></body></html>  \n\nThe settings above lead to eight different combinations, shown in Table 2 (#1 - #8). Additional training details are in Appendix A .\n\n# 3.2 Main Results\nWe evaluate ZST systems using SacreBLEU ( Post ,2018 ) and off-target rates. We report in Table 2 BLEU scores for both zero-shot and supervised directions. For ZST, we also present pivot-based translation results as a reference. Implementation details of evaluation can be found in Appendix B.Our findings are as follows:  \n\nPreNorm vs. PostNorm :We find that PostNorm consistently yields better BLEU scores than PreNorm for ZST across various language tag and residual connection settings, while their performance is comparable for supervised directions.  \n\nImpact of Language Tag and Residual Connection: We observe that using the \u201cT-ENC\u201d language tag and \u201cw/ Res.\u201d improves ZST performance for IWSLT, which aligns with the findings of $\\\\mathrm{Wu}$ et al. (2021 ) and Liu et al. (2021 ). Nevertheless, the best performance is achieved using \u201cw/ Res.\u201d for PostNorm with \u201cS-ENC-T-DEC\u201d and \u201cT-ENC\u201d tags for OPUS and Europarl, respectively (#2 and #4). Given that Wu et al. (2021 ) and Liu et al. (2021 )used PreNorm as the default setting (#2, #4, #6 and #8 are unreported results in their work), our results emphasize the need to consider PostNorm as the default setting for ZST, while the language tag and residual connection settings have less impact.  \n\nOff-target Rates : Off-target rates help understand the different BLEU score gaps between PreNorm and PostNorm, which ranges from 0 .5 to 12 .3 BLEU points. For PreNorm and PostNorm with the \u201cT-ENC\u201d language tag (#3, #4, #7, and #8), they have similar off-target rates, with a discrepancy ranging from $-0.61\\\\%$ to $2.02\\\\%$ , which results in narrow BLEU score gaps, ranging from 0 .5 to 1 .8 points. However, for PreNorm and PostNorm with the \u201cS-ENC-T-DEC\u201d language tag (#1, #2, #5, and #6), the off-target rates show a more considerable discrepancy, ranging from $5.40\\\\%$ to $54.23\\\\%$ , resulting in BLEU score gaps from 1 .7 to 12 .3 points. Further analysis of the nature of Transformer hidden states in the next section explores the reason for these different off-target rates in translations.\u300d\n", "dreams_guidance_context": "### Step 1: \u786e\u5b9a\u7814\u7a76\u7684\u5173\u952e\u95ee\u9898\u548c\u76ee\u6807\n - **\u5173\u952e\u95ee\u9898**\uff1a\n    - \u5404\u7c7b\u6846\u67b6\uff08\u5982Transformer\u3001GAN\u3001BERT\u7b49\uff09\u5728\u4e0d\u540c\u4efb\u52a1\u4e2d\u7684\u5e94\u7528\u4e0e\u53d8\u4f53\u60c5\u51b5\u5982\u4f55\uff1f\n    - \u5728\u57fa\u4e8eTransformer\u7684\u8ba1\u7b97\u673a\u89c6\u89c9\u6a21\u578b\u4e2d\uff0cLayerNorm\u548cRMSNorm\u5982\u4f55\u8fdb\u884c\u9002\u5e94\u6027\u8c03\u6574\u548c\u53d8\u4f53\u5e94\u7528\u4ee5\u9002\u914d\u89c6\u89c9\u4efb\u52a1\u9700\u6c42\uff1f\n    - \u5982\u4f55\u89e3\u51b3\u5728HE\u4e0a\u8ba1\u7b97LayerNorm\u7684\u95ee\u9898\uff0c\u4ee5\u53ca\u9488\u5bf9\u89c6\u89c9\u548cNLP\u4efb\u52a1\u5e94\u91c7\u53d6\u4f55\u79cd\u4e0d\u540c\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\uff1f\n    - \u5982\u4f55\u6784\u5efa\u591a\u9879\u5f0fTransformer\uff1f\n    - PreNorm\u548cPostNorm\u5728\u96f6\u6837\u672c\u7ffb\u8bd1\uff08ZST\uff09\u4efb\u52a1\u4e2d\u7684\u6027\u80fd\u5dee\u5f02\u53ca\u5f71\u54cd\u56e0\u7d20\u662f\u4ec0\u4e48\uff1f\n - **\u7814\u7a76\u76ee\u6807**\uff1a\n    - \u6df1\u5165\u5206\u6790\u4e3b\u6d41\u6846\u67b6\u5728\u4e0d\u540c\u4efb\u52a1\u4e2d\u7684\u5e94\u7528\u5f62\u5f0f\u4e0e\u53d8\u4f53\u521b\u65b0\u3002\n    - \u660e\u786eLayerNorm\u548cRMSNorm\u5728\u89c6\u89c9\u4efb\u52a1\u4e2d\u7684\u9002\u914d\u7b56\u7565\u53ca\u6548\u679c\u3002\n    - \u63d0\u51fa\u9488\u5bf9\u89c6\u89c9\u548cNLP\u4efb\u52a1\u7684HE\u53cb\u597d\u578b\u5f52\u4e00\u5316\u65b9\u6cd5\uff0c\u63d0\u5347\u6a21\u578b\u5728HE\u73af\u5883\u4e0b\u7684\u8bad\u7ec3\u7a33\u5b9a\u6027\u548c\u6027\u80fd\u3002\n    - \u6784\u5efa\u6709\u6548\u7684\u591a\u9879\u5f0fTransformer\u6a21\u578b\uff0c\u5e76\u8bc4\u4f30\u5176\u5728\u8bed\u8a00\u5efa\u6a21\u548c\u56fe\u50cf\u5206\u7c7b\u4efb\u52a1\u4e2d\u7684\u6027\u80fd\u3002\n    - \u5168\u9762\u8bc4\u4f30PreNorm\u548cPostNorm\u5728ZST\u4efb\u52a1\u4e2d\u7684\u6027\u80fd\uff0c\u5206\u6790\u8131\u9776\u7387\u548c\u7ed3\u6784\u5dee\u5f02\u5bf9\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u4e3aZST\u4efb\u52a1\u63d0\u4f9b\u4f18\u5316\u7b56\u7565\u3002\n\n### Step 2: \u68b3\u7406\u7b97\u6cd5\u548c\u65b9\u6cd5\n - **\u6846\u67b6\u5e94\u7528\u4e0e\u53d8\u4f53**\uff1a\u7814\u7a76\u5404\u7c7b\u6846\u67b6\u5728\u4e0d\u540c\u4efb\u52a1\u4e2d\u7684\u5e94\u7528\uff0c\u91cd\u70b9\u5173\u6ce8Transformer\u5728\u8ba1\u7b97\u673a\u89c6\u89c9\u6a21\u578b\u4e2d\u7684\u5e94\u7528\uff0c\u4ee5\u53caLayerNorm\u548cRMSNorm\u7684\u9002\u5e94\u6027\u8c03\u6574\u548c\u53d8\u4f53\u5e94\u7528\u3002\n - **LayerNorm\u4e0eRMSNorm\u8f6c\u6362**\uff1a\u5c06transformer\u7f51\u7edc\u4e2d\u7684LayerNorm\u8f6c\u6362\u4e3aRMSNorm\u65f6\uff0c\u5bf9\u4e0d\u540c\u6a21\u5757\u8fdb\u884c\u64cd\u4f5c\uff0c\u5305\u62ec\u8c03\u6574\u6b63\u4ea4\u77e9\u9635\u3001\u5bf9\u8f93\u5165\u8f93\u51fa\u77e9\u9635\u505a\u7279\u5b9a\u53d8\u6362\uff0c\u5728\u6b8b\u5dee\u8fde\u63a5\u4e2d\u6dfb\u52a0\u65b0\u7684\u7ebf\u6027\u5c42\uff0c\u5229\u7528PCA\u8ba1\u7b97\u6b63\u4ea4\u77e9\u9635\u3002\n - **HE\u53cb\u597d\u578b\u5f52\u4e00\u5316**\uff1a\n    - **\u89c6\u89c9\u4efb\u52a1**\uff1a\u5728\u89c6\u89c9transformers\u7684MLP\u548c$\\sigma$-attention\u91cc\u6dfb\u52a0\u989d\u5916BatchNorm\uff0c\u4ee5\u6539\u5584\u6027\u80fd\u548c\u8bad\u7ec3\u7a33\u5b9a\u6027\u3002\n    - **NLP\u4efb\u52a1**\uff1a\u901a\u8fc7\u8fd1\u4f3c\u591a\u9879\u5f0f\u6765\u903c\u8fd1LayerNorm\uff0c\u5148\u7f29\u5c0f\u65b9\u5dee\u8303\u56f4\uff0c\u518d\u5229\u7528\u5df2\u77e5\u8fd1\u4f3c\u65b9\u6cd5\u5904\u7406\u5f00\u65b9\u5012\u6570\u3002\n - **\u6784\u5efa\u591a\u9879\u5f0fTransformer**\uff1a\u5206\u4e09\u4e2a\u9636\u6bb5\uff0c\u9996\u5148\u5c06\u539f\u59cb\u67b6\u6784\u4fee\u6539\u6210HE\u53cb\u597d\u578b\u67b6\u6784\uff0c\u63a5\u7740\u8fdb\u884c\u8865\u5145\u8bad\u7ec3\u83b7\u5f97HE\u53cb\u597d\u578b\u6743\u91cd\uff08\u901a\u8fc7\u6dfb\u52a0\u635f\u5931\u51fd\u6570\u9650\u5236\u975e\u591a\u9879\u5f0f\u5c42\u7684\u8f93\u5165\u8303\u56f4\uff09\uff0c\u6700\u540e\u7528\u591a\u9879\u5f0f\u8fd1\u4f3c\u66ff\u6362\u975e\u591a\u9879\u5f0f\u5c42\u3002\n - **PreNorm\u548cPostNorm\u8bc4\u4f30**\uff1a\u5728\u4e0d\u540c\u6570\u636e\u96c6\u548c\u8bed\u8a00\u5bf9\u4e0a\u5bf9PreNorm\u548cPostNorm\u5728\u96f6\u6837\u672c\u7ffb\u8bd1\uff08ZST\uff09\u4efb\u52a1\u4e2d\u8fdb\u884c\u5b9e\u9a8c\uff0c\u5206\u6790\u5b83\u4eec\u7684\u8131\u9776\u7387\u548c\u7ed3\u6784\u5dee\u5f02\u3002\n\n### Step 3: \u5206\u6790\u5b9e\u9a8c\u8bbe\u8ba1\u548c\u7ed3\u679c\n - **\u5b9e\u9a8c\u8bbe\u8ba1**\uff1a\n    - **\u6846\u67b6\u5e94\u7528\u4e0e\u53d8\u4f53**\uff1a\u672a\u660e\u786e\u63d0\u53ca\u5177\u4f53\u5b9e\u9a8c\u8bbe\u8ba1\uff0c\u4f46\u56f4\u7ed5\u4e0d\u540c\u6846\u67b6\u5728\u4e0d\u540c\u4efb\u52a1\u4e2d\u7684\u5e94\u7528\u4e0e\u53d8\u4f53\u5c55\u5f00\u7814\u7a76\u3002\n    - **LayerNorm\u4e0eRMSNorm\u8f6c\u6362**\uff1a\u4f7f\u7528HuggingFace Transformers\u548cPyTorch\u5b9e\u73b0\u4ee3\u7801\uff0c\u5728\u5355\u5f20H100 GPU\u4e0a\u8ba1\u7b97$\\mathbf{Q}$\uff0c\u5bf9\u4e0d\u540c\u6a21\u578b\uff08OPT\u3001LLAMA - 2\u3001Phi-2\u7b49\uff09\u5728\u8bed\u8a00\u751f\u6210\u548c\u96f6\u6837\u672c\u4efb\u52a1\u4e0a\u8fdb\u884c\u8bc4\u4f30\uff0c\u91c7\u7528\u4e0d\u540c\u6821\u51c6\u96c6\uff08WikiText-2\u3001Alpaca\uff09\u548c\u4e0d\u540cGPU\uff08Quadro RTX6000\u3001A100\u3001H100\uff09\u8fdb\u884c\u5b9e\u9a8c\uff0c\u5e76\u8bbe\u7f6e\u4e86\u5bf9\u6bd4\u57fa\u7ebf\uff08\u5982\u4e0eSparseGPT\u5bf9\u6bd4\uff09\u3002\n    - **HE\u53cb\u597d\u578b\u5f52\u4e00\u5316**\uff1a\u5728\u8bed\u8a00\u5efa\u6a21\u4efb\u52a1\u4e2d\u4f7f\u7528Wikitext-103\u6570\u636e\u96c6\uff0c\u5728\u56fe\u50cf\u5206\u7c7b\u4efb\u52a1\u4e2d\u4f7f\u7528Tiny-ImageNet\u548cCIFAR-100\u7b49\u6807\u51c6\u57fa\u51c6\u6570\u636e\u96c6\uff0c\u901a\u8fc7\u5bf9\u6bd4\u4e0d\u540c\u9636\u6bb5\u6a21\u578b\uff08\u5982\u539f\u59cb\u6a21\u578b\u3001\u4f7f\u7528\u7279\u5b9a\u6ce8\u610f\u529b\u673a\u5236\u548c\u5f52\u4e00\u5316\u65b9\u6cd5\u7684\u6a21\u578b\u3001\u7ecf\u8fc7\u8303\u56f4\u6700\u5c0f\u5316\u8bad\u7ec3\u7684\u6a21\u578b\u3001\u6700\u7ec8\u591a\u9879\u5f0f\u6a21\u578b\uff09\u7684\u6027\u80fd\u6765\u8bc4\u4f30\u65b9\u6cd5\u6709\u6548\u6027\u3002\n    - **PreNorm\u548cPostNorm\u8bc4\u4f30**\uff1a\u5728OPUS\u3001IWSLT\u3001Europarl\u4e09\u4e2a\u6570\u636e\u96c6\u4e0a\u8fdb\u884cZST\u5b9e\u9a8c\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u8bed\u8a00\u6807\u7b7e\uff08S-ENC-T-DEC\u3001T-ENC\uff09\u3001\u662f\u5426\u6709\u6b8b\u5dee\u8fde\u63a5\uff08w/ Res.\u3001w/o Res.\uff09\u7b49\u56e0\u7d20\uff0c\u5f62\u6210\u516b\u79cd\u4e0d\u540c\u7ec4\u5408\u8fdb\u884c\u5b9e\u9a8c\uff0c\u4f7f\u7528SacreBLEU\u8bc4\u4f30ZST\u7cfb\u7edf\u5e76\u8ba1\u7b97\u8131\u9776\u7387\u3002\n - **\u5b9e\u9a8c\u7ed3\u679c**\uff1a\n    - **\u6846\u67b6\u5e94\u7528\u4e0e\u53d8\u4f53**\uff1a\u672a\u660e\u786e\u63d0\u53ca\u5177\u4f53\u7ed3\u679c\uff0c\u4f46\u9610\u8ff0\u4e86\u76f8\u5173\u64cd\u4f5c\u5bf9\u6a21\u578b\u5207\u7247\u548c\u901f\u5ea6\u63d0\u5347\u7684\u91cd\u8981\u6027\u3002\n    - **LayerNorm\u4e0eRMSNorm\u8f6c\u6362**\uff1a\u5b9e\u73b0\u4e86\u6a21\u578b\u5207\u7247\uff0c\u6574\u4f53\u4e0a\u6709\u901f\u5ea6\u63d0\u5347\uff0c\u4f46\u989d\u5916\u64cd\u4f5c\u7ed9\u6a21\u578b\u5e26\u6765\u4e00\u5b9a$(D\u00d7D)$\u7684\u5f00\u9500\u3002\n    - **HE\u53cb\u597d\u578b\u5f52\u4e00\u5316**\uff1a\u591a\u9879\u5f0f\u6a21\u578b\u5728\u8bed\u8a00\u5efa\u6a21\u548c\u56fe\u50cf\u5206\u7c7b\u4efb\u52a1\u4e2d\u4e0e\u539f\u59cb\u6a21\u578b\u6027\u80fd\u5dee\u8ddd\u8f83\u5c0f\uff08\u8bed\u8a00\u5efa\u6a21\u4e2d\uff0c6\u5c42\u6a21\u578b perplexity\u589e\u52a00.91\uff0c12\u5c42\u6a21\u578b\u589e\u52a02.02\uff1b\u56fe\u50cf\u5206\u7c7b\u4e2d\uff0c\u6027\u80fd\u5dee\u8ddd\u5c0f\u4e8e4%\uff09\uff0c\u8bc1\u660e\u65b9\u6cd5\u5177\u6709\u4e00\u5b9a\u5b9e\u7528\u6027\u3002\n    - **PreNorm\u548cPostNorm\u8bc4\u4f30**\uff1a\u5728ZST\u4efb\u52a1\u4e2d\uff0cPostNorm\u7684BLEU\u5206\u6570\u901a\u5e38\u6bd4PreNorm\u66f4\u9ad8\uff0c\u5728\u76d1\u7763\u5b66\u4e60\u65b9\u5411\u4e0a\u4e8c\u8005\u6027\u80fd\u76f8\u8fd1\uff1b\u201cT-ENC\u201d\u8bed\u8a00\u6807\u7b7e\u548c\u201cw/ Res.\u201d\u8bbe\u7f6e\u5bf9IWSLT\u7684ZST\u6027\u80fd\u6709\u63d0\u5347\uff0c\u5bf9\u4e8eOPUS\u548cEuroparl\uff0cPostNorm\u642d\u914d \u201cS-ENC-T-DEC\u201d\u548c\u201cT-ENC\u201d\u6807\u7b7e\u4e14\u4f7f\u7528\u201cw/ Res.\u201d\u65f6\u6027\u80fd\u6700\u4f73\uff1b\u4e0d\u540c\u8bed\u8a00\u6807\u7b7e\u8bbe\u7f6e\u4e0b\uff0cPreNorm\u548cPostNorm\u7684\u8131\u9776\u7387\u5dee\u5f02\u5bfc\u81f4\u4e86BLEU\u5206\u6570\u5dee\u8ddd\u4e0d\u540c\u3002\n\n### Step 4: \u8bc4\u4f30\u7814\u7a76\u7684\u5c40\u9650\u6027\u548c\u672a\u6765\u65b9\u5411\n - **\u5c40\u9650\u6027**\uff1a\n    - **LayerNorm\u4e0eRMSNorm\u8f6c\u6362**\uff1a\u989d\u5916\u64cd\u4f5c\u7ed9\u6a21\u578b\u5e26\u6765\u4e00\u5b9a\u7684\u8ba1\u7b97\u5f00\u9500\u3002\n    - **HE\u53cb\u597d\u578b\u5f52\u4e00\u5316**\uff1a\u591a\u9879\u5f0f\u8fd1\u4f3c\u5bfc\u81f4\u6a21\u578b\u6027\u80fd\u6709\u4e00\u5b9a\u4e0b\u964d\uff0c\u5982\u8bed\u8a00\u5efa\u6a21\u548c\u56fe\u50cf\u5206\u7c7b\u4efb\u52a1\u4e2d\u4e0e\u539f\u59cb\u6a21\u578b\u5b58\u5728\u6027\u80fd\u5dee\u8ddd\u3002\n    - **PreNorm\u548cPostNorm\u8bc4\u4f30**\uff1a\u672a\u63d0\u53ca\u660e\u663e\u5c40\u9650\u6027\uff0c\u4f46\u5b9e\u9a8c\u53ef\u80fd\u53d7\u6570\u636e\u96c6\u3001\u6a21\u578b\u67b6\u6784\u7b49\u591a\u79cd\u56e0\u7d20\u9650\u5236\uff0c\u7ed3\u679c\u7684\u666e\u9002\u6027\u6709\u5f85\u8fdb\u4e00\u6b65\u9a8c\u8bc1\u3002\n - **\u672a\u6765\u65b9\u5411**\uff1a\n    - **LayerNorm\u4e0eRMSNorm\u8f6c\u6362**\uff1a\u672a\u63d0\u53ca\uff0c\u53ef\u8003\u8651\u8fdb\u4e00\u6b65\u4f18\u5316\u64cd\u4f5c\u4ee5\u51cf\u5c11\u8ba1\u7b97\u5f00\u9500\u3002\n    - **HE\u53cb\u597d\u578b\u5f52\u4e00\u5316**\uff1a\u4f7f\u7528\u66f4\u51c6\u786e\u7684\u591a\u9879\u5f0f\u8fd1\u4f3c\u65b9\u6cd5\u6765\u8fdb\u4e00\u6b65\u7f29\u5c0f\u4e0e\u539f\u59cb\u6a21\u578b\u7684\u6027\u80fd\u5dee\u8ddd\u3002\n    - **PreNorm\u548cPostNorm\u8bc4\u4f30**\uff1a\u53ef\u6269\u5927\u6570\u636e\u96c6\u548c\u6a21\u578b\u67b6\u6784\u7684\u8303\u56f4\u8fdb\u884c\u5b9e\u9a8c\uff0c\u8fdb\u4e00\u6b65\u63a2\u7d22\u5f71\u54cdZST\u6027\u80fd\u7684\u5176\u4ed6\u56e0\u7d20\uff0c\u4f18\u5316ZST\u6a21\u578b\u8bbe\u8ba1\u3002  ", "evolutionary_step": "\u8fd9\u6bb5\u5bf9\u8bdd\u4e3b\u8981\u56f4\u7ed5\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2dTransformer\u7b49\u6a21\u578b\u5728\u4e0d\u540c\u4efb\u52a1\u4e2d\u7684\u5e94\u7528\u3001\u9002\u5e94\u6027\u8c03\u6574\u3001\u5b9e\u9a8c\u9a8c\u8bc1\u4ee5\u53ca\u76f8\u5173\u7406\u8bba\u5206\u6790\u5c55\u5f00\uff0c\u6d89\u53ca\u8ba1\u7b97\u673a\u7b97\u6cd5\u4f18\u5316\u3001\u4eba\u5de5\u667a\u80fd\u7cfb\u7edf\u53cd\u9988\u673a\u5236\u5e94\u7528\u7b49\u65b9\u9762\uff0c\u5177\u4f53\u603b\u7ed3\u5982\u4e0b\uff1a\n1. **\u7814\u7a76\u4e3b\u8981\u6846\u67b6\u7684\u5e94\u7528\u4e0e\u53d8\u4f53**\uff1a\u63a2\u8ba8Transformer\u3001GAN\u3001BERT\u7b49\u4e3b\u8981\u6846\u67b6\u5728\u4e0d\u540c\u4efb\u52a1\u4e2d\u7684\u5e94\u7528\u4e0e\u53d8\u4f53\uff0c\u4f8b\u5982\u5728\u57fa\u4e8eTransformer\u7684\u8ba1\u7b97\u673a\u89c6\u89c9\u6a21\u578b\u4e2d\uff0c\u7814\u7a76LayerNorm\u548cRMSNorm\u4e3a\u9002\u914d\u89c6\u89c9\u4efb\u52a1\u9700\u6c42\u6240\u505a\u7684\u9002\u5e94\u6027\u8c03\u6574\u548c\u53d8\u4f53\u5e94\u7528\u3002\n2. **\u6a21\u578b\u8f6c\u6362\u4e0e\u8ba1\u7b97**\uff1a\u5c06Transformer\u7f51\u7edc\u4e2d\u7684LayerNorm\u8f6c\u6362\u4e3aRMSNorm\uff0c\u5e76\u5728\u6b64\u57fa\u7840\u4e0a\u5e94\u7528\u8ba1\u7b97\u4e0d\u53d8\u6027\u601d\u60f3\u5bf9\u6a21\u578b\u8fdb\u884c\u4fee\u6539\uff0c\u5305\u62ec\u5bf9\u8f93\u5165\u8f93\u51fa\u6743\u91cd\u77e9\u9635\u7684\u64cd\u4f5c\u4ee5\u53ca\u5728\u6b8b\u5dee\u8fde\u63a5\u4e2d\u6dfb\u52a0\u65b0\u7684\u7ebf\u6027\u5c42\u7b49\u3002\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u4f7f\u7528PCA\u6765\u8ba1\u7b97\u77e9\u9635\\(Q_l\\)\uff0c\u5e76\u901a\u8fc7\u5b9e\u9a8c\u9a8c\u8bc1\u8be5\u65b9\u6cd5\u5bf9\u6a21\u578b\u901f\u5ea6\u548c\u6027\u80fd\u7684\u5f71\u54cd\u3002\n3. **\u6a21\u578b\u5b9e\u9a8c\u9a8c\u8bc1**\uff1a\u4f7f\u7528HuggingFace Transformers\u548cPyTorch\u5b9e\u73b0\u4ee3\u7801\uff0c\u5728\u591a\u79cd\u6a21\u578b\uff08\u5982OPT\u3001LLAMA - 2\u3001Phi-2\uff09\u548c\u4efb\u52a1\u4e0a\u8fdb\u884c\u5b9e\u9a8c\uff0c\u5bf9\u6bd4\u4e0d\u540c\u6821\u51c6\u96c6\u3001\u6a21\u578b\u3001\u4efb\u52a1\u4ee5\u53caGPU\u8bbe\u7f6e\u4e0b\u7684\u7ed3\u679c\uff0c\u5e76\u4e0eSparseGPT\u8fdb\u884c\u5bf9\u6bd4\u3002\n4. **\u5f52\u4e00\u5316\u65b9\u6cd5\u7814\u7a76**\uff1a\u4e3a\u589e\u5f3a\u8bad\u7ec3\u7a33\u5b9a\u6027\uff0c\u7814\u7a76\u9488\u5bf9\u4e0d\u540c\u4efb\u52a1\uff08\u89c6\u89c9\u548c\u81ea\u7136\u8bed\u8a00\u5904\u7406\uff09\u7684\u5f52\u4e00\u5316\u65b9\u6cd5\u3002\u5728\u89c6\u89c9Transformer\u4e2d\u6dfb\u52a0\u989d\u5916\u7684BatchNorm\uff1b\u5728\u81ea\u7136\u8bed\u8a00\u5904\u7406Transformer\u4e2d\uff0c\u901a\u8fc7\u5f15\u5165\u989d\u5916\u635f\u5931\u51fd\u6570\u7f29\u5c0f\u65b9\u5dee\u8303\u56f4\uff0c\u4ee5\u5b9e\u73b0\u7528\u591a\u9879\u5f0f\u8fd1\u4f3cLayerNorm\u3002\n5. **\u591a\u9879\u5f0fTransformer\u6784\u5efa**\uff1a\u63d0\u51fa\u6784\u5efa\u591a\u9879\u5f0fTransformer\u7684\u65b9\u6cd5\uff0c\u5305\u62ec\u5c06\u539f\u59cb\u67b6\u6784\u4fee\u6539\u4e3a\u5bf9\u540c\u6001\u52a0\u5bc6\uff08HE\uff09\u53cb\u597d\u7684\u67b6\u6784\u3001\u8fdb\u884c\u8865\u5145\u8bad\u7ec3\u4ee5\u83b7\u5f97HE\u53cb\u597d\u7684\u6743\u91cd\u3001\u5c06\u975e\u591a\u9879\u5f0f\u5c42\u66ff\u6362\u4e3a\u591a\u9879\u5f0f\u8fd1\u4f3c\u4e09\u4e2a\u9636\u6bb5\uff0c\u5e76\u901a\u8fc7\u5b9e\u9a8c\u8bc4\u4f30\u751f\u6210\u7684\u591a\u9879\u5f0f\u6a21\u578b\u5728\u8bed\u8a00\u5efa\u6a21\u548c\u56fe\u50cf\u5206\u7c7b\u4efb\u52a1\u4e2d\u7684\u6027\u80fd\u3002\n6. **PreNorm\u548cPostNorm\u7684\u5b9e\u9a8c\u8bc4\u4f30**\uff1a\u5728\u591a\u79cd\u6570\u636e\u96c6\u548c\u8bed\u8a00\u5bf9\u4e0a\u8bc4\u4f30PreNorm\u548cPostNorm\u5728\u96f6\u6837\u672c\u7ffb\u8bd1\uff08ZST\uff09\u4efb\u52a1\u4e2d\u7684\u6027\u80fd\uff0c\u5206\u6790\u5b83\u4eec\u7684\u8131\u9776\u7387\u548c\u7ed3\u6784\u5dee\u5f02\uff0c\u63a2\u8ba8\u8bed\u8a00\u6807\u7b7e\u548c\u6b8b\u5dee\u8fde\u63a5\u5bf9ZST\u6027\u80fd\u7684\u5f71\u54cd\uff0c\u53d1\u73b0PostNorm\u5728ZST\u4efb\u52a1\u4e2d\u901a\u5e38\u6bd4PreNorm\u53d6\u5f97\u66f4\u597d\u7684BLEU\u5206\u6570 \u3002  ", "dreams_personality_context": "\u4ece\u4e0a\u8ff0\u7814\u7a76\u5185\u5bb9\u63a8\u6d4b\uff0c\u7247\u6bb5\u4e2d\u4eba\u7269\u53ef\u80fd\u5177\u6709\u4ee5\u4e0b\u6027\u683c\u7279\u70b9\uff1a\n1. **\u597d\u5947\u5fc3\u5f3a**\uff1a\u5bf9\u8ba1\u7b97\u673a\u79d1\u5b66\u591a\u4e2a\u524d\u6cbf\u9886\u57df\uff0c\u5982\u4e0d\u540c\u6a21\u578b\u6846\u67b6\u5728\u5404\u79cd\u4efb\u52a1\u4e2d\u7684\u5e94\u7528\u3001\u4e0d\u540c\u5f52\u4e00\u5316\u65b9\u6cd5\u7b49\u90fd\u5c55\u5f00\u7814\u7a76\uff0c\u5c55\u73b0\u51fa\u5bf9\u65b0\u77e5\u8bc6\u3001\u65b0\u9886\u57df\u5f3a\u70c8\u7684\u63a2\u7d22\u6b32\u671b\uff0c\u4e0d\u5c40\u9650\u4e8e\u5355\u4e00\u65b9\u5411\uff0c\u6e34\u671b\u6316\u6398\u66f4\u591a\u672a\u77e5\u5185\u5bb9\u3002\n2. **\u52c7\u4e8e\u521b\u65b0**\uff1a\u79ef\u6781\u5c1d\u8bd5\u5bf9\u73b0\u6709\u6a21\u578b\u8fdb\u884c\u5404\u79cd\u6539\u8fdb\u548c\u521b\u65b0\uff0c\u4f8b\u5982\u5c06LayerNorm\u8f6c\u6362\u4e3aRMSNorm\u5e76\u57fa\u4e8e\u6b64\u4fee\u6539\u6a21\u578b\uff0c\u63d0\u51fa\u6784\u5efa\u591a\u9879\u5f0fTransformer\u7684\u65b0\u65b9\u6cd5\u7b49\uff0c\u6562\u4e8e\u7a81\u7834\u4f20\u7edf\u601d\u8def\uff0c\u63a2\u7d22\u65b0\u7684\u6280\u672f\u8def\u5f84\u3002\n3. **\u4e25\u8c28\u7ec6\u81f4**\uff1a\u5728\u7814\u7a76\u8fc7\u7a0b\u4e2d\uff0c\u65e0\u8bba\u662f\u6a21\u578b\u8f6c\u6362\u4e2d\u7684\u5177\u4f53\u8ba1\u7b97\uff08\u5982\u7528PCA\u8ba1\u7b97\u77e9\u9635\\(Q_l\\)\uff09\uff0c\u8fd8\u662f\u5b9e\u9a8c\u9a8c\u8bc1\u73af\u8282\uff08\u5728\u591a\u79cd\u6a21\u578b\u3001\u4efb\u52a1\u3001\u8bbe\u7f6e\u4e0b\u8fdb\u884c\u5bf9\u6bd4\u5b9e\u9a8c\uff09\uff0c\u90fd\u4f53\u73b0\u51fa\u5bf9\u7814\u7a76\u7ec6\u8282\u7684\u9ad8\u5ea6\u5173\u6ce8\uff0c\u529b\u6c42\u7814\u7a76\u7ed3\u679c\u7684\u51c6\u786e\u6027\u548c\u53ef\u9760\u6027\u3002\n4. **\u575a\u97e7\u6267\u7740**\uff1a\u9762\u5bf9\u590d\u6742\u7684\u8ba1\u7b97\u673a\u79d1\u5b66\u7814\u7a76\u95ee\u9898\uff0c\u6d89\u53ca\u591a\u4e2a\u6b65\u9aa4\u548c\u5927\u91cf\u5b9e\u9a8c\uff0c\u80fd\u591f\u6301\u7eed\u6295\u5165\u7cbe\u529b\uff0c\u4ece\u6a21\u578b\u7684\u7406\u8bba\u5206\u6790\u5230\u5b9e\u9645\u5e94\u7528\uff0c\u518d\u5230\u4e0d\u540c\u65b9\u6cd5\u7684\u5bf9\u6bd4\u8bc4\u4f30\uff0c\u575a\u6301\u4e0d\u61c8\u5730\u8ffd\u6c42\u7814\u7a76\u7684\u6df1\u5165\u548c\u5b8c\u5584\u3002\n5. **\u7406\u6027\u5ba2\u89c2**\uff1a\u901a\u8fc7\u5927\u91cf\u5b9e\u9a8c\u6570\u636e\u6765\u9a8c\u8bc1\u65b9\u6cd5\u7684\u6709\u6548\u6027\uff0c\u5982\u5bf9\u6bd4\u4e0d\u540c\u6821\u51c6\u96c6\u3001\u6a21\u578b\u3001\u4efb\u52a1\u4ee5\u53caGPU\u8bbe\u7f6e\u4e0b\u7684\u7ed3\u679c\uff0c\u4e0e\u5176\u4ed6\u65b9\u6cd5\uff08\u5982SparseGPT\uff09\u8fdb\u884c\u5bf9\u6bd4\u7b49\uff0c\u4ee5\u5ba2\u89c2\u6570\u636e\u4e3a\u4f9d\u636e\u6765\u5224\u65ad\u7814\u7a76\u6210\u679c\uff0c\u4e0d\u4e3b\u89c2\u81c6\u65ad\u3002  ", "ref_analysis_id": ""}, "__type__": "dreams_node"}}, "analysis_store/ref_analysis_info": {"": {"node_ids": ["f99c68db-aedb-4ef1-8026-99057ee65ad3"], "metadata": {}}}, "analysis_store/metadata": {"f99c68db-aedb-4ef1-8026-99057ee65ad3": {"analysis_hash": "", "ref_analysis_id": ""}}}